# IAM User Management from YAML Configuration

## Overview

This project automates AWS IAM user provisioning and policy management using Terraform with YAML-based configuration. It reads user definitions from a YAML file, creates IAM users with login profiles, and automatically attaches multiple AWS managed policies based on user roles.

## Architecture

The infrastructure provisions the following AWS resources:

- IAM users created from YAML configuration
- IAM login profiles with secure password generation
- AWS managed policy attachments based on user roles
- Support for multiple policies per user

## Features

- YAML-based user configuration for easy management
- Automated IAM user creation
- Secure password generation with configurable length
- Multiple policy attachment per user
- Lifecycle management to prevent password drift
- Dynamic user-role pairing using Terraform locals
- Support for AWS managed policies

## Prerequisites

- AWS CLI configured with appropriate credentials
- Terraform version 1.0 or higher
- AWS account with IAM administrative permissions
- YAML file containing user definitions

## Project Structure

```
Practice_Project4/
├── iam.tf          # IAM user and policy attachment resources
├── locals.tf       # YAML parsing and user-role pairing logic
├── providers.tf    # AWS provider configuration
├── terraform.tf    # Terraform version requirements
├── outputs.tf      # Output definitions for created users
└── users.yaml      # User configuration file
```

## YAML Configuration Format

The `users.yaml` file defines users and their assigned roles:

```yaml
users:
  - username: john.doe
    roles:
      - ReadOnlyAccess
      - AmazonS3ReadOnlyAccess
  - username: jane.smith
    roles:
      - PowerUserAccess
      - AmazonEC2FullAccess
```

Each user can have multiple roles, which map to AWS managed policies.

## How It Works

1. **YAML Parsing**: Terraform reads and decodes the `users.yaml` file
2. **User Creation**: Creates IAM users for each entry in the YAML
3. **Password Generation**: Generates 12-character passwords for each user
4. **Policy Attachment**: Flattens user-role pairs and attaches policies
5. **Lifecycle Management**: Prevents password reset drift after initial creation

## User-Role Pairing Logic

The project uses Terraform's `flatten` function to create individual policy attachments:

- Reads all users from YAML
- Iterates through each user's roles
- Creates a unique attachment for each user-role combination
- Uses composite key format: `username-role` for unique identification

## Deployment

1. Navigate to the project directory
2. Create or update `users.yaml` with your user configurations
3. Initialize Terraform:
   ```bash
   terraform init
   ```
4. Review the planned changes:
   ```bash
   terraform plan
   ```
5. Apply the configuration:
   ```bash
   terraform apply
   ```

## Managing Users

### Adding New Users

Add entries to `users.yaml`:

```yaml
users:
  - username: new.user
    roles:
      - ReadOnlyAccess
```

Then apply changes:

```bash
terraform apply
```

### Modifying User Roles

Update the roles list in `users.yaml` and reapply:

```bash
terraform apply
```

### Removing Users

Remove the user entry from `users.yaml` and apply:

```bash
terraform apply
```

## Password Management

- Initial password length: 12 characters
- Passwords are auto-generated by AWS
- Users are not required to reset password on first login
- Lifecycle rules prevent password configuration drift
- Passwords can be retrieved via AWS Console or CLI by administrators

## Supported AWS Managed Policies

Common AWS managed policies that can be used:

- `ReadOnlyAccess` - Read-only access to all AWS services
- `PowerUserAccess` - Full access except IAM and Organizations
- `AdministratorAccess` - Full administrative access
- `AmazonEC2FullAccess` - Full EC2 access
- `AmazonS3ReadOnlyAccess` - Read-only S3 access
- `AmazonRDSFullAccess` - Full RDS access
- And many more AWS managed policies

View all available policies:

```bash
aws iam list-policies --scope AWS --query 'Policies[*].PolicyName'
```

## Outputs

The project outputs information about created resources:

- List of created usernames
- User ARNs
- Login profile status
- Policy attachment details

## Security Considerations

- Passwords are managed by AWS and not stored in Terraform state
- Use AWS managed policies instead of inline policies
- Follow principle of least privilege when assigning roles
- Regularly audit user permissions
- Enable MFA for users with elevated privileges
- Monitor CloudTrail for user activity

## Cleanup

To remove all IAM users and policy attachments:

```bash
terraform destroy
```

Warning: This will delete all users and their access. Ensure no users are actively being used.

## Best Practices Implemented

- Infrastructure as code for user management
- YAML configuration for easy updates
- Lifecycle management to prevent drift
- Modular resource definitions
- Unique resource naming using composite keys
- Support for multiple policies per user
- No hardcoded credentials

## Use Cases

- Automated IAM user provisioning for teams
- Role-based access control implementation
- Multi-user environment setup
- Learning Terraform data transformations
- Demonstrating YAML integration with Terraform

## Advantages Over Manual Management

- Version-controlled user configuration
- Consistent and repeatable user creation
- Easy bulk user management
- Audit trail through version control
- Reduced human error
- Automated policy attachment

## Troubleshooting

**Invalid Policy ARN:**
- Verify the policy name matches AWS managed policy exactly
- Check for typos in `users.yaml`
- Ensure the policy exists in your AWS region

**User Already Exists:**
- Check if user was created outside Terraform
- Import existing user into Terraform state
- Use unique usernames

**Password Not Found:**
- Passwords are not stored in Terraform state
- Retrieve via AWS Console's IAM section
- Use AWS CLI to generate new credentials if needed

## Extension Ideas

- Add custom IAM policies in addition to managed policies
- Implement user groups for easier management
- Add email notifications for user creation
- Integrate with AWS SSO
- Add conditional policy attachments
- Implement user tagging from YAML

## License

This project is provided as-is for educational and professional use.
